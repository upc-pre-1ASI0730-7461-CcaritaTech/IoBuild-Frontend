<script setup>
import { ref, watch } from 'vue';

const props = defineProps({
  visible: {
    type: Boolean,
    required: true
  },
  client: {
    type: Object,
    default: null
  }
});

const emit = defineEmits(['update:visible', 'save']);

const localVisible = ref(props.visible);
const formData = ref({
  id: null,
  fullName: '',
  email: '',
  phoneNumber: '',
  address: '',
  projectId: null,
  projectName: '',
  accountStatement: 'Active'
});

watch(() => props.visible, (newVal) => {
  localVisible.value = newVal;
  if (newVal && props.client) {
    formData.value = { ...props.client };
  }
});

watch(localVisible, (newVal) => {
  emit('update:visible', newVal);
});

const handleSave = () => {
  emit('save', formData.value);
  localVisible.value = false;
};

const handleCancel = () => {
  localVisible.value = false;
};

const accountStatementOptions = [
  { label: 'Active', value: 'Active' },
  { label: 'Stand by', value: 'Stand by' },
  { label: 'Suspended', value: 'Suspended' }
];
</script>

<template>
  <pv-dialog
    v-model:visible="localVisible"
    modal
    header="Edit Client"
    :style="{ width: '600px' }"
    class="client-edit-dialog"
  >
    <div class="grid">
      <div class="col-12 mb-3">
        <label for="fullName" class="block mb-2 font-semibold">Full Name</label>
        <pv-input-text
          id="fullName"
          v-model="formData.fullName"
          class="w-full"
        />
      </div>

      <div class="col-12 mb-3">
        <label for="email" class="block mb-2 font-semibold">Email</label>
        <pv-input-text
          id="email"
          v-model="formData.email"
          class="w-full"
          type="email"
        />
      </div>

      <div class="col-12 mb-3">
        <label for="phoneNumber" class="block mb-2 font-semibold">Phone Number</label>
        <pv-input-text
          id="phoneNumber"
          v-model="formData.phoneNumber"
          class="w-full"
        />
      </div>

      <div class="col-12 mb-3">
        <label for="address" class="block mb-2 font-semibold">Address</label>
        <pv-input-text
          id="address"
          v-model="formData.address"
          class="w-full"
        />
      </div>

      <div class="col-12 mb-3">
        <label for="projectName" class="block mb-2 font-semibold">Project Name</label>
        <pv-input-text
          id="projectName"
          v-model="formData.projectName"
          class="w-full"
        />
      </div>

      <div class="col-12">
        <label for="accountStatement" class="block mb-2 font-semibold">Account Statement</label>
        <pv-select
          id="accountStatement"
          v-model="formData.accountStatement"
          :options="accountStatementOptions"
          optionLabel="label"
          optionValue="value"
          class="w-full"
        />
      </div>
    </div>

    <template #footer>
      <pv-button
        label="Cancel"
        icon="pi pi-times"
        @click="handleCancel"
        severity="danger"
        outlined
      />
      <pv-button
        label="Save"
        icon="pi pi-check"
        @click="handleSave"
        severity="success"
      />
    </template>
  </pv-dialog>
</template>

<style scoped>
/* Forzar fondo blanco en el di√°logo principal */
:deep(.p-dialog) {
  background: white !important;
}

:deep(.p-dialog .p-dialog-header) {
  background: white !important;
  color: #111827 !important;
}

:deep(.p-dialog .p-dialog-content) {
  background: white !important;
  color: #111827 !important;
}

:deep(.p-dialog .p-dialog-footer) {
  background: white !important;
}

/* Estilos para inputs */
:deep(.p-inputtext) {
  background: white !important;
  color: #111827 !important;
  border-color: #d1d5db !important;
}

:deep(.p-inputtext:enabled:hover) {
  background: white !important;
  border-color: #9ca3af !important;
}

:deep(.p-inputtext:enabled:focus) {
  background: white !important;
  border-color: #3b82f6 !important;
  box-shadow: 0 0 0 0.2rem rgba(59, 130, 246, 0.25) !important;
}

/* Estilos para el select */
:deep(.p-select) {
  background: white !important;
  color: #111827 !important;
  border-color: #d1d5db !important;
}

:deep(.p-select:hover) {
  background: white !important;
  border-color: #9ca3af !important;
}

:deep(.p-select:focus) {
  background: white !important;
  border-color: #3b82f6 !important;
  box-shadow: 0 0 0 0.2rem rgba(59, 130, 246, 0.25) !important;
}

:deep(.p-select .p-select-label) {
  background: white !important;
  color: #111827 !important;
}

:deep(.p-select .p-select-dropdown) {
  background: white !important;
  color: #111827 !important;
}

/* Labels flotantes */
:deep(.p-float-label label) {
  color: #6b7280 !important;
  background: transparent !important;
}

:deep(.p-float-label input:focus ~ label),
:deep(.p-float-label input:not(:placeholder-shown) ~ label) {
  color: #3b82f6 !important;
  background: white !important;
}

:deep(label) {
  color: #374151 !important;
}

/* Grid del formulario */
:deep(.grid) {
  background: white !important;
}

/* Estilos para los botones del footer */
:deep(.p-button) {
  color: white !important;
}

:deep(.p-button.p-button-danger.p-button-outlined) {
  background: #fee2e2 !important;
  border-color: #ef4444 !important;
  color: #dc2626 !important;
}

:deep(.p-button.p-button-danger.p-button-outlined:hover) {
  background: #fecaca !important;
  border-color: #dc2626 !important;
  color: #991b1b !important;
}

:deep(.p-button-success) {
  background: #10b981 !important;
  border-color: #10b981 !important;
  color: white !important;
}

:deep(.p-button-success:hover) {
  background: #059669 !important;
  border-color: #059669 !important;
  color: white !important;
}
</style>
